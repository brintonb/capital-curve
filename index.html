<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Capital Curve Calculator — Deep Tech</title>
  <link href="https://fonts.googleapis.com/css2?family=Signika:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --bb-green:#A8D08D; --bb-black:#000; --muted:#666; --bg:#fff; --card:#f8f9fa; }
    * { box-sizing: border-box; }
    body {
      font-family: "Signika", system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg); color: var(--bb-black); margin: 0; padding: 24px; line-height: 1.35;
    }
    .wrap { max-width: 960px; margin: 0 auto; }
    .title { font-size: 28px; font-weight: 700; margin: 0 0 8px; }
    .subtitle { color: var(--muted); margin: 0 0 20px; }
    .card { background: var(--card); border-radius: 16px; padding: 16px; margin-bottom: 16px;
            box-shadow: 0 2px 10px rgba(0,0,0,.04); }
    label { display:block; font-weight:700; margin: 10px 0 6px; }
    select, input[type="range"] { width: 100%; }
    .row { display:grid; gap:16px; grid-template-columns: 1fr 1fr; }
    .row-3 { display:grid; gap:16px; grid-template-columns: 1fr 1fr 1fr; }
    .hint { color: var(--muted); font-size: 14px; }
    .badge { display:inline-block; padding:4px 8px; border-radius:999px; background:#eef2ef; color:#1f3422;
             font-size:12px; font-weight:600; }
    .legend-dot { width:12px; height:12px; border-radius:50%; display:inline-block; margin-right:6px; vertical-align:middle; }
    .legend { font-size: 14px; color: var(--muted); }
    .btn { display:inline-block; padding:10px 14px; border-radius:10px; background: var(--bb-black); color:#fff;
           text-decoration:none; font-weight:600; }
    @media (max-width: 780px) { .row, .row-3 { grid-template-columns: 1fr; } }

    /* Responsive, bounded chart size driven by CSS */
    .chart-shell { width:100%; }
    #chart {
      width: 100%;
      height: clamp(260px, 55vh, 560px); /* min 260px, scales with viewport, max 560px */
      display: block;                    /* remove inline baseline gaps */
    }
  </style>
</head>
<body>
<div class="wrap">
  <h1 class="title">AI Capital Curve Calculator — Deep Tech</h1>
  <p class="subtitle">Client‑side demo. No servers. Adjust AI leverage sliders to see how early capital compresses while regulatory/fabrication floors hold.</p>

  <div class="card">
    <div class="row-3">
      <div>
        <label>Sector</label>
        <select id="sector">
          <option>Biopharma</option>
          <option>Biomed Device</option>
          <option>Digital Health</option>
        </select>
      </div>
      <div>
        <label>Milestones</label>
        <div class="hint">Ideation · Proof of Concept · Preclinical/Prototype · Reg/Clinical Gate · Series A</div>
      </div>
      <div>
        <label>Assumptions</label>
        <span class="badge">Floors enforce wet‑lab / fab / regulatory costs</span>
      </div>
    </div>
  </div>

  <div class="card">
    <label>AI leverage per task (0 = no help, 1 = full automation of that task’s share)</label>
    <div id="sliders" class="row-3"></div>

    <div class="row" style="margin-top:8px">
      <div>
        <label>AI intensity (global)</label>
        <input id="intensity" type="range" min="0.5" max="1.5" step="0.05" value="1">
        <div class="hint" id="intensityMeter">×1.00</div>
      </div>
      <div>
        <label class="hint" style="font-weight:600">Tasks</label>
        <div class="hint">Literature/landscaping, In‑silico modeling, Data ops/analysis, Regulatory drafting, Prototype automation</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="legend" style="margin-bottom:8px">
      <span class="legend-dot" style="background:#000"></span>Pre‑AI
      &nbsp;&nbsp;
      <span class="legend-dot" style="background:var(--bb-green)"></span>AI‑Adjusted
    </div>
    <div class="chart-shell">
      <canvas id="chart"></canvas>
    </div>
    <div class="hint" id="summary" style="margin-top:10px"></div>
  </div>

  <div class="card">
    <label>Share safely</label>
    <p class="hint">Safe Link Here.</p>
    <a class="btn" href="#" id="copyLink">Copy shareable state link</a>
    <span id="copyMsg" class="hint" style="margin-left:8px"></span>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script>
/* --------------------------
   Model tensors & constants
   -------------------------- */
const sectors = ["Biopharma","Biomed Device","Digital Health"];
const milestones = ["Ideation","Proof of Concept","Preclinical/Prototype","Reg/Clinical Gate","Series A"];
const tasks = ["Literature & Landscaping","In‑silico Modeling/Simulation","Data Ops & Analysis","Regulatory Drafting","Prototype Automation"];

// Baseline relative costs [sector x milestone] (Series A normalized ~10)
const baseCost = [
  [1.0, 3.0, 7.0, 9.0, 10.0], // Biopharma
  [0.8, 2.5, 5.0, 8.0, 10.0], // Biomed Device
  [0.6, 1.5, 3.0, 4.0, 10.0], // Digital Health
];

// Floors by sector (non-compressible costs)
const floors = {
  "Biopharma":      [0.4, 1.2, 3.5, 7.5, 10.0],
  "Biomed Device":  [0.3, 1.0, 2.8, 6.0, 10.0],
  "Digital Health": [0.2, 0.6, 1.0, 2.0, 10.0]
};

// Weights [sector x milestone x task], sum=1 across tasks at each (sector,milestone)
const W = {
  "Biopharma": {
    "Ideation":[0.45,0.25,0.20,0.10,0.00],
    "Proof of Concept":[0.30,0.25,0.25,0.20,0.00],
    "Preclinical/Prototype":[0.10,0.20,0.20,0.25,0.25],
    "Reg/Clinical Gate":[0.05,0.10,0.15,0.45,0.25],
    "Series A":[0.00,0.00,0.10,0.70,0.20]
  },
  "Biomed Device": {
    "Ideation":[0.35,0.25,0.25,0.15,0.00],
    "Proof of Concept":[0.20,0.25,0.25,0.15,0.15],
    "Preclinical/Prototype":[0.05,0.25,0.20,0.15,0.35],
    "Reg/Clinical Gate":[0.05,0.10,0.15,0.35,0.35],
    "Series A":[0.00,0.00,0.10,0.60,0.30]
  },
  "Digital Health": {
    "Ideation":[0.30,0.15,0.45,0.10,0.00],
    "Proof of Concept":[0.20,0.15,0.45,0.20,0.00],
    "Preclinical/Prototype":[0.10,0.10,0.55,0.25,0.00],
    "Reg/Clinical Gate":[0.05,0.05,0.60,0.30,0.00],
    "Series A":[0.00,0.00,0.50,0.50,0.00]
  }
};

// Defaults for AI leverage per task (0..1)
let ai = [0.6, 0.6, 0.5, 0.4, 0.3];
let intensity = 1.0;

/* --------------------------
   Helpers
   -------------------------- */
const dot = (a,b)=>a.reduce((s,v,i)=>s+v*b[i],0);
const slidersDiv = document.getElementById('sliders');
const sectorSel = document.getElementById('sector');
const summaryDiv = document.getElementById('summary');
const intensityEl = document.getElementById('intensity');
const intensityMeter = document.getElementById('intensityMeter');

function effectiveAI() { return ai.map(v => Math.max(0, Math.min(1, v * intensity))); }

// Compute adjusted costs for a sector
function compute(sector) {
  const si = sectors.indexOf(sector);
  const base = baseCost[si];
  const floorVec = floors[sector];

  // Pre-AI respects floors (so AI line never looks worse)
  const pre = base.map((v, i) => Math.max(v, floorVec[i]));

  const aiEff = effectiveAI();
  const adj = milestones.map((m, idx) => {
    const red = Math.min(0.9, Math.max(0, dot(W[sector][m], aiEff)));
    const raw = base[idx] * (1 - red);
    return Math.max(floorVec[idx], raw);
  });

  return { base: pre, adj };
}

/* --------------------------
   Sliders
   -------------------------- */
function makeSlider(label, idx, val){
  const wrap = document.createElement('div');
  const lab = document.createElement('label'); lab.textContent = label;

  const input = document.createElement('input');
  input.type = 'range'; input.min = '0'; input.max = '1'; input.step = '0.05'; input.value = String(val);

  const meter = document.createElement('div');
  meter.className = 'hint'; meter.textContent = `AI leverage: ${val}`;

  const apply = (v) => {
    const num = Number(v);
    ai[idx] = isNaN(num) ? 0 : num;
    meter.textContent = `AI leverage: ${ai[idx]}`;
    update();
  };

  input.addEventListener('input',  e => apply(e.target.value));
  input.addEventListener('change', e => apply(e.target.value));

  wrap.appendChild(lab); wrap.appendChild(input); wrap.appendChild(meter);
  slidersDiv.appendChild(wrap);
}
tasks.forEach((t,i)=>makeSlider(t,i,ai[i]));

intensityEl.addEventListener('input', e => {
  intensity = Number(e.target.value);
  intensityMeter.textContent = '×' + intensity.toFixed(2);
  update();
});

/* --------------------------
   Chart (CSS controls height)
   -------------------------- */
const ctx = document.getElementById('chart').getContext('2d');
let chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: milestones,
    datasets: [
      { label:'Pre‑AI', data: [], borderColor:'#000', backgroundColor:'#000', tension:.25, pointRadius:4 },
      { label:'AI‑Adjusted', data: [], borderColor:'rgba(168,208,141,1)', backgroundColor:'rgba(168,208,141,1)', tension:.25, pointRadius:4 }
    ]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,   // let CSS (#chart height) drive the size
    scales: {
      y: {
        beginAtZero: true, suggestedMax: 11,
        grid: { color:'rgba(0,0,0,0.08)' },
        title: { display: true, text: 'Capital Required (relative index)', color:'#000',
                 font:{ family:'Signika', weight:'600' } }
      },
      x: {
        grid: { color:'rgba(0,0,0,0.05)' },
        title: { display: true, text: 'Milestones', color:'#666',
                 font:{ family:'Signika', weight:'600' } }
      }
    },
    plugins: {
      legend: { display:false },
      tooltip: { callbacks: { label: ctx => `${ctx.dataset.label}: ${ctx.parsed.y.toFixed(2)} (rel.)` } }
    }
  }
});

/* --------------------------
   Render/update
   -------------------------- */
function update() {
  const sector = sectorSel.value;
  const { base, adj } = compute(sector);
  chart.data.datasets[0].data = base.slice();
  chart.data.datasets[1].data = adj.slice();
  chart.update();

  const baseSum = base.reduce((a,b)=>a+b,0).toFixed(1);
  const adjSum  = adj.reduce((a,b)=>a+b,0).toFixed(1);
  const earlyBase = base.slice(0,3).reduce((a,b)=>a+b,0);
  const earlyAdj  = adj.slice(0,3).reduce((a,b)=>a+b,0);
  const earlyDrop = ((1 - earlyAdj/earlyBase) * 100).toFixed(0);
  summaryDiv.textContent = `${sector}: early‑stage capital ↓ ~${earlyDrop}% | Total (rel.): Pre‑AI ${baseSum} → AI‑Adjusted ${adjSum}`;
}

// share current state (sector + sliders) in URL hash
function encodeState(){ return encodeURIComponent(JSON.stringify({s: sectorSel.value, ai, intensity})); }
function decodeState(hash){ try { return JSON.parse(decodeURIComponent(hash.slice(1))); } catch { return null; } }

const copyBtn = document.getElementById('copyLink');
const copyMsg = document.getElementById('copyMsg');
copyBtn.addEventListener('click', async (e)=>{
  e.preventDefault();
  const url = `${location.origin}${location.pathname}#${encodeState()}`;
  try { await navigator.clipboard.writeText(url); copyMsg.textContent = "Copied link!"; }
  catch { copyMsg.textContent = url; }
});

sectorSel.addEventListener('change', update);

// initialize with state if present
const st = decodeState(location.hash);
if (st) {
  sectorSel.value = st.s || sectorSel.value;
  ai = Array.isArray(st.ai) ? st.ai : ai;
  intensity = typeof st.intensity === 'number' ? st.intensity : intensity;

  // hydrate sliders
  const sliderNodes = slidersDiv.querySelectorAll('input[type="range"]');
  sliderNodes.forEach((n,i)=>{ n.value = ai[i]; n.dispatchEvent(new Event('input')); });
  document.getElementById('intensity').value = intensity;
  document.getElementById('intensityMeter').textContent = '×' + intensity.toFixed(2);
}
update();
</script>
</body>
</html>
